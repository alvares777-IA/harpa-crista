<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Harpa Cristã - Seus hinos favoritos">
    <meta name="theme-color" content="#1a1a2e">
    <title>Favoritos - Harpa Cristã</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNavbar">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <i class="bi bi-music-note-beamed me-2"></i>
                <span class="brand-text">Harpa Cristã</span>
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house-heart me-1"></i> Início
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="favoritos.html">
                            <i class="bi bi-heart me-1"></i> Favoritos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sobre.html">
                            <i class="bi bi-info-circle me-1"></i> Sobre
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="favorites-header">
        <div class="container">
            <h1><i class="bi bi-heart-fill me-2" style="color: var(--accent-rose)"></i>Meus Favoritos</h1>
            <p id="favCount">Seus hinos favoritos</p>
        </div>
    </section>

    <!-- Favorites List -->
    <section class="hymns-section">
        <div class="container">
            <div class="hymns-container list-view" id="favoritesContainer">
                <!-- Rendered dynamically -->
            </div>

            <!-- Empty State -->
            <div class="empty-favorites d-none" id="emptyFavorites">
                <i class="bi bi-heart"></i>
                <h3>Nenhum hino favoritado</h3>
                <p>Toque no ícone <i class="bi bi-heart"></i> em qualquer hino para adicioná-lo aqui.</p>
                <a href="index.html" class="btn-go-home">
                    <i class="bi bi-house-heart"></i> Explorar Hinos
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container text-center">
            <div class="footer-brand justify-content-center">
                <i class="bi bi-music-note-beamed"></i>
                <span>Harpa Cristã</span>
            </div>
            <p class="footer-text">Aplicativo offline com todos os 640 hinos oficiais.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/hinos-data.js"></script>
    <script src="js/app.js"></script>
    <script>
        $(document).ready(function () {
            // Navbar scroll
            $(window).on('scroll', function () {
                if ($(this).scrollTop() > 50) {
                    $('#mainNavbar').addClass('scrolled');
                } else {
                    $('#mainNavbar').removeClass('scrolled');
                }
            });

            function renderFavorites() {
                var $container = $('#favoritesContainer');
                var $empty = $('#emptyFavorites');
                $container.empty();

                var favs = [];
                try {
                    favs = JSON.parse(localStorage.getItem('harpa_favoritos') || '[]');
                } catch (e) { }

                if (favs.length === 0) {
                    $empty.removeClass('d-none');
                    $('#favCount').text('Nenhum hino favoritado ainda');
                    return;
                }

                $empty.addClass('d-none');
                $('#favCount').text(favs.length + ' hino' + (favs.length > 1 ? 's' : '') + ' favoritado' + (favs.length > 1 ? 's' : ''));

                favs.forEach(function (num) {
                    var hymn = null;
                    for (var i = 0; i < HINOS_DATA.length; i++) {
                        if (HINOS_DATA[i].numero === num) { hymn = HINOS_DATA[i]; break; }
                    }
                    if (!hymn) return;

                    var preview = '';
                    if (hymn.letra && hymn.letra.versos && hymn.letra.versos[0]) {
                        preview = hymn.letra.versos[0].texto.split('\n')[0];
                        if (preview.length > 60) preview = preview.substring(0, 60) + '...';
                    }

                    var card = '<div class="hymn-card fade-in" data-numero="' + hymn.numero + '">' +
                        '<div class="hymn-number">' + hymn.numero + '</div>' +
                        '<div class="hymn-info" onclick="window.location.href=\'hino.html?n=' + hymn.numero + '\'">' +
                        '<div class="hymn-title">' + hymn.titulo + '</div>' +
                        '<div class="hymn-preview">' + preview + '</div>' +
                        '</div>' +
                        '<div class="hymn-actions">' +
                        '<button class="hymn-action-btn btn-remove-fav favorited" data-numero="' + hymn.numero + '" title="Remover dos favoritos">' +
                        '<i class="bi bi-heart-fill"></i>' +
                        '</button>' +
                        '<button class="hymn-action-btn btn-open" onclick="window.location.href=\'hino.html?n=' + hymn.numero + '\'" title="Abrir hino">' +
                        '<i class="bi bi-chevron-right"></i>' +
                        '</button>' +
                        '</div></div>';

                    $container.append(card);
                });
            }

            // Remove from favorites
            $(document).on('click', '.btn-remove-fav', function (e) {
                e.stopPropagation();
                var numero = parseInt($(this).data('numero'));
                if (window.HarpaApp) {
                    window.HarpaApp.toggleFavorite(numero);
                }
                $(this).closest('.hymn-card').fadeOut(300, function () {
                    $(this).remove();
                    renderFavorites();
                });
            });

            renderFavorites();
        });
    </script>
</body>

</html>